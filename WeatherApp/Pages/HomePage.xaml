<?xml version="1.0" encoding="utf-8"?>

<pages:MvvmContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                       xmlns:vm="clr-namespace:WeatherApp.ViewModels"
                       xmlns:pages="clr-namespace:WeatherApp.Pages"
                       x:Class="WeatherApp.Pages.HomePage"
                       x:TypeArguments="vm:HomeViewModel"
                       Title="Home">

    <pages:MvvmContentPage.ToolbarItems>
        <ToolbarItem Text="Add Location" Command="{Binding AddLocationCommand}" />
    </pages:MvvmContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto, 2*">
        <Grid Grid.Row="0"
              HeightRequest="200"
              BackgroundColor="CornflowerBlue">

        </Grid>
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding LocationGroups}"
                        IsGrouped="True"
                        SelectionMode="None">
            <CollectionView.EmptyViewTemplate>
                <DataTemplate>
                    <VerticalStackLayout VerticalOptions="Center"
                                         HorizontalOptions="Center">
                        <Label Text="No locations"
                               FontSize="Title"
                               HorizontalOptions="Center" />
                        <Label Text="(try adding some)"
                               HorizontalOptions="Center"
                               FontSize="Caption" />
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.EmptyViewTemplate>

            <CollectionView.GroupHeaderTemplate>
                <DataTemplate>
                    <Label Text="{Binding Title}"
                           TextColor="{Binding TextColor}"
                           FontAttributes="Bold"
                           FontSize="18"
                           Padding="10,5" />
                </DataTemplate>
            </CollectionView.GroupHeaderTemplate>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="10,5"
                           Padding="10"
                           BorderColor="LightGray"
                           CornerRadius="5"
                           HasShadow="True">
                        <VerticalStackLayout Spacing="5">

                            <Label Text="{Binding Address}"
                                   FontAttributes="Bold"
                                   FontSize="Medium" />

                            <Label Text="{Binding CurrentWeatherRecord.Condition}"
                                   FontSize="Small"
                                   TextColor="DarkGray" />

                            <HorizontalStackLayout Spacing="15">
                                <Label Text="{Binding CurrentWeatherRecord.Temperature, StringFormat='Temp: {0:F1}°C'}"
                                       FontSize="Small" />
                                <Label Text="{Binding CurrentWeatherRecord.Humidity, StringFormat='Humidity: {0:F0}%'}"
                                       FontSize="Small" />
                            </HorizontalStackLayout>

                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>

</pages:MvvmContentPage>